clear;clc;close all

tic
dates_all={'Mar_19_13' 'Mar_21_13' 'Mar_21_13' 'Apr_12_13' 'May_30_13' 'May_31_13'...
    'May_31_13' 'May_31_13' 'Jun_24_13' 'Jun_24_13' 'Jul_03_13' 'Jul_03_13'...
    'Jul_29_13' 'Jul_29_13' 'Aug_05_13' 'Aug_16_13' 'Sep_05_13' 'Sep_16_13'...
    'Oct_08_13' 'Oct_08_13' 'Mar_18_14'};% 'Sep_10_13' used synaptic blockers
cellnum_all={'B' 'A' 'B' 'A' 'A' 'B'...
    'C' 'D' 'A' 'B' 'A' 'B'...
    'A' 'B' 'A' 'A' 'A' 'A'...
    'A' 'B' 'A'};% Used synaptic blockers: 'A'
trials_all=[2 5;3 4;2 3;2 3;2 3;2 3;...
    2 3;2 3;2 3;2 3;2 3;2 3;...
    2 3;4 5;2 3;2 3;2 3;3 2;...
    3 2;3 2;1 2;];% Used synaptic blockers: 2 3;

for k=1:numel(dates_all)
    recdate=dates_all{k};
    cellnum=cellnum_all{k};
    module='fi_curves';
    load([module '_' recdate '_' cellnum])
    % trials=1:numel(whos)-3;
    trials=trials_all(k,:);
    sample_rate=10000;   % Sample rate in Hz
    saveit=1;
    
    [rate,ISI,imp,pulse_duration,pause_duration,delay,increments,currents,deriv_rate]=...
        deriv_frequency(module,recdate,cellnum,trials,sample_rate);
    
    if saveit~=0
        save([pwd '\..\..\F_I_curves\data\deriv_freq_analysis\' module '_' recdate '_' cellnum '_deriv_freq'],'rate','ISI','imp',...
            'pulse_duration','pause_duration','delay','increments','currents','deriv_rate')
    end
end

% if saveit~=0
%     save([module '_' recdate '_' cellnum '_rates'],'rate_all','rate_init','rate_accom',...
%         'spikeform','imp','pulse_duration','pause_duration','delay',...
%         'increments','currents','pf_init','pf_accom','sigfit_init','sigfit_accom',...
%         'sigslope_init','sigslope_accom')
% end

toc