clear;clc;close all

tic

dates_all={'Oct_03_14' 'Oct_03_14' 'Oct_06_14' 'Oct_06_14' 'Oct_06_14' 'Oct_06_14'...
    'Oct_14_14' 'Oct_14_14' 'Oct_14_14' 'Oct_14_14' 'Oct_15_14' 'Oct_23_14'...
    'Oct_23_14' 'Oct_23_14' 'Oct_24_14' 'Oct_24_14' 'Nov_26_14' 'Jan_27_15'...
    'Jan_27_15' 'Jan_27_15' 'Jan_27_15' 'Feb_03_15' 'Feb_03_15' 'Feb_03_15'...
    'Feb_10_15' 'Feb_10_15'};
cellnum_all={'B' 'B' 'A' 'A' 'C' 'C'...
    'A' 'A' 'B' 'C' 'A' 'A'...
    'A' 'A' 'A' 'B' 'A' 'A'...
    'A' 'B' 'B' 'A' 'B' 'C'...
    'B' 'C'};
trials_all=[4 5 3 4 3 4 ...
    2 4 1 1 1 1 ...
    2 3 2 2 2 1 ...
    2 2 1 1 1 1 ...
    1 1]';

for k=1:numel(dates_all)
    recdate=dates_all{k};
    cellnum=cellnum_all{k};
    module='FI_OU';
    % trials=1:numel(whos)-3;
    trials=trials_all(k,:);
    sample_rate=10000;   % Sample rate in Hz
    saveit=1;
        
    [rate_all,ISI,rate_init,spike1avg,spike2avg,spike3avg,spikelastavg,spikelastriseavg,pulse_duration,pause_duration,delay,...
        increments,currents]=first_three_spikes_noise(module,recdate,cellnum,trials,sample_rate);
    
    if saveit~=0
        save([pwd '\..\..\FI_OU\data\spikes_analysis\' module '_' recdate '_' cellnum num2str(trials) '_spikes'],'rate_init',...
            'spike1avg','spike2avg','spike3avg','spikelastavg','spikelastriseavg','pulse_duration',...
            'pause_duration','delay','increments','currents')
    end
end

% close all

toc