clear;clc;close all

tic

% dates_all={'Oct_03_14' 'Oct_03_14' 'Oct_06_14' 'Oct_06_14' 'Oct_06_14' 'Oct_06_14'...
%     'Oct_14_14' 'Oct_14_14' 'Oct_14_14'}; % End of hyperpolarized with noise (1 sec, 1 sec)
% dates_all={'Oct_14_14' 'Oct_15_14' 'Oct_23_14' 'Oct_23_14' 'Oct_23_14' 'Oct_24_14'...
%     'Oct_24_14'}; % End of hyperpolarized with noise (5 sec, 5 sec)
% dates_all={'Nov_26_14' 'Jan_27_15' 'Jan_27_15' 'Jan_27_15' 'Jan_27_15' 'Feb_03_15'...
%     'Feb_03_15' 'Feb_03_15' 'Feb_10_15' 'Feb_10_15' 'Mar_03_15' 'Mar_06_15'...
%     'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15'...
%     'Mar_10_15' 'Mar_10_15' 'Mar_11_15' 'Mar_11_15' 'Mar_11_15' 'Mar_16_15'...
%     'Mar_16_15' 'Mar_16_15' 'Mar_16_15' 'Mar_16_15' 'Mar_16_15' 'Mar_16_15'...
%     'Mar_17_15' 'Mar_17_15' 'Mar_18_15' 'Mar_18_15' 'Mar_18_15' 'Mar_23_15'...
%     'Mar_23_15' 'Mar_23_15' 'Mar_23_15' 'Mar_23_15' 'Mar_24_15' 'Mar_24_15'...
%     'Mar_24_15' 'Mar_24_15' 'Mar_27_15' 'Apr_03_15' 'Apr_06_15' 'Apr_07_15'...
%     'Apr_07_15' 'Apr_07_15'}; % End of hyperpolarized with noise (5 sec, 1 sec)
% dates_all={'Oct_14_14' 'Oct_14_14'}; % End of depolarized with just noise (1 sec, 1 sec)
% dates_all={'Oct_14_14' 'Oct_15_14' 'Oct_23_14' 'Oct_24_14'}; % End of depolarized with just noise (5 sec, 5 sec)
% dates_all={'Jan_27_15' 'Jan_27_15' 'Feb_03_15' 'Feb_03_15' 'Feb_03_15' 'Feb_10_15'...
%     'Feb_10_15' 'Mar_03_15' 'Mar_06_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15'...
%     'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_10_15' 'Mar_11_15'...
%     'Mar_11_15' 'Mar_11_15' 'Mar_16_15' 'Mar_16_15' 'Mar_16_15' 'Mar_16_15'...
%     'Mar_16_15' 'Mar_16_15' 'Mar_17_15' 'Mar_17_15' 'Mar_18_15' 'Mar_23_15'...
%     'Mar_23_15' 'Mar_23_15' 'Mar_23_15' 'Mar_23_15' 'Mar_24_15' 'Mar_24_15'...
%     'Mar_24_15' 'Mar_24_15' 'Mar_27_15' 'Apr_03_15' 'Apr_06_15' 'Apr_07_15'...
%     'Apr_07_15' 'Apr_07_15'}; % End of depolarized with just noise (5 sec, 1 sec)
% dates_all={'Oct_24_14' 'Oct_24_14' 'Oct_28_14' 'Oct_30_14' 'Nov_26_14' 'Jan_07_15'...
%     'Jan_07_15' 'Mar_17_15' 'Mar_18_15' 'Mar_23_15' 'Mar_23_15' 'Mar_24_15'...
%     'Mar_24_15' 'Mar_27_15' 'Apr_06_15' 'Apr_07_15' 'Apr_07_15' 'Apr_07_15'}; % End of depolarized with leak and noise
% dates_all={'Mar_24_15' 'Mar_27_15' 'Mar_28_15' 'Mar_28_15' 'Mar_30_15' 'Mar_30_15'...
%     'Mar_30_15' 'Apr_10_15' 'Apr_10_15' 'Apr_10_15' 'Apr_10_15' 'May_05_15'...
%     'May_05_15' 'May_05_15' 'May_05_15'}; % End of hyperpolarized with noise non-cholinergic neurons
dates_all={'Mar_24_15' 'Mar_27_15' 'Mar_28_15' 'Mar_28_15' 'Mar_30_15' 'Mar_30_15'...
    'Mar_30_15' 'Apr_10_15' 'Apr_10_15' 'Apr_10_15' 'Apr_10_15' 'Apr_10_15'...
    'May_05_15' 'May_05_15' 'May_05_15' 'May_05_15'}; % End of depolarized with just noise non-cholinergic neurons

% cellnum_all={'B' 'B' 'A' 'A' 'C' 'C'...
%     'A' 'A' 'B'}; % End of hyperpolarized with noise (1 sec, 1 sec)
% cellnum_all={'C' 'A' 'A' 'A' 'A' 'A'...
%     'B'}; % End of hyperpolarized with noise (5 sec, 5 sec)
% cellnum_all={'A' 'A' 'A' 'B' 'B' 'A'...
%     'B' 'C' 'B' 'C' 'A' 'A'...
%     'A' 'A' 'A' 'B' 'B' 'C'...
%     'C' 'D' 'A' 'B' 'B' 'A'...
%     'B' 'B' 'B' 'C' 'C' 'D'...
%     'A' 'B' 'A' 'A' 'B' 'B'...
%     'B' 'C' 'D' 'E' 'A' 'A'...
%     'B' 'B' 'A' 'B' 'B' 'A'...
%     'C' 'D'}; % End of hyperpolarized with noise (5 sec, 1 sec)
% cellnum_all={'A' 'B'}; % End of depolarized with just noise (1 sec, 1 sec)
% cellnum_all={'C' 'A' 'A' 'B'}; % End of depolarized with just noise (5 sec, 5 sec)
% cellnum_all={'A' 'B' 'A' 'B' 'C' 'B'...
%     'C' 'A' 'A' 'A' 'A' 'A'...
%     'B' 'B' 'C' 'C' 'D' 'A'...
%     'B' 'B' 'A' 'B' 'B' 'B'...
%     'C' 'C' 'A' 'B' 'B' 'B'...
%     'B' 'C' 'D' 'E' 'A' 'A'...
%     'B' 'B' 'A' 'B' 'B' 'A'...
%     'C' 'D'}; % End of depolarized with just noise (5 sec, 1 sec)
% cellnum_all={'A' 'B' 'A' 'A' 'A' 'A'...
%     'B' 'A' 'A' 'B' 'E' 'A'...
%     'B' 'A' 'B' 'A' 'C' 'D'}; % End of depolarized with leak and noise
% cellnum_all={'C' 'B' 'B' 'C' 'A' 'B'...
%     'C' 'A' 'A' 'A' 'C' 'A'...
%     'B' 'C' 'C'}; % End of hyperpolarized with noise non-cholinergic neurons
cellnum_all={'C' 'B' 'B' 'C' 'A' 'B'...
    'C' 'A' 'A' 'A' 'A' 'C'...
    'A' 'B' 'C' 'C'}; % End of depolarized with just noise non-cholinergic neurons

% trials_all=[4 5 3 4 3 4 ...
%     2 4 1]'; % End of hyperpolarized with noise (1 sec, 1 sec)
% trials_all=[1 1 1 2 3 2 ...
%     2]'; % End of hyperpolarized with noise (5 sec, 5 sec)
% trials_all=[2 1 2 2 1 1 ...
%     1 1 1 1 1 1 ...
%     1 3 5 1 3 1 ...
%     3 1 1 1 3 1 ...
%     1 3 5 1 3 1 ...
%     1 1 2 3 1 1 ...
%     3 1 1 1 1 4 ...
%     1 3 1 1 1 1 ...
%     1 1]'; % End of hyperpolarized with noise (5 sec, 1 sec)
% trials_all=[3 2]'; % End of depolarized with just noise (1 sec, 1 sec)
% trials_all=[2 2 3 3]'; % End of depolarized with just noise (5 sec, 5 sec)
% trials_all=[4 4 2 2 2 2 ...
%     2 2 2 2 4 6 ...
%     2 4 2 4 2 2 ...
%     2 4 2 2 4 6 ...
%     2 4 2 2 2 2 ...
%     4 2 2 2 2 5 ...
%     2 4 2 2 2 2 ...
%     2 2]'; % End of depolarized with just noise (5 sec, 1 sec)
% trials_all=[1 1 1 1 1 1 ...
%     1 3 1 5 3 3 ...
%     5 3 3 3 3 3]'; % End of depolarized with leak and noise
% trials_all=[1 1 1 1 1 1 ...
%     1 1 3 6 1 1 ...
%     1 1 3]'; % End of hyperpolarized with noise non-cholinergic neurons
trials_all=[2 2 2 2 2 2 ...
    2 2 4 5 7 2 ...
    2 2 2 4]'; % End of depolarized with just noise non-cholinergic neurons

points_all=repmat([1 21],size(trials_all));
%     [13 20;15 20;11 18;14 20;4 17;5 14;...
%     6 20;6 18;8 16;5 19;6 18;3 13;...
%     7 11;3 11;5 19;3 16;4 20;6 14;...
%     10 16;5 17;6 10;5 17;6 19;4 20;...
%     4 20;7 18;]; % End of hyperpolarized with noise
%     8 19;11 21;5 21;6 19;3 11;5 16;...
%     11 21;7 16;7 21;7 20;6 18;5 20;...
%     8 20;]; % End of depolarized with just noise
%     6 15;10 21;7 21;7 19;4 15;2 10;...
%     5 13;]; % End of depolarized with leak and noise

for k=1:numel(dates_all)
    recdate=dates_all{k};
    cellnum=cellnum_all{k};
    module='FI_OU';
    % trials=1:numel(whos)-3;
    trials=trials_all(k,:);
    points=points_all(k,:);
    sample_rate=10000;   % Sample rate in Hz
    shouldplotFI=0; % Should the function plot the F-I curves? 1 for yes, 0 for no.
    saveit=1;
    
    [rate_all,peakrate,nofailrate,mean_holdingvoltage,...
        numberspikes,thresholds,imp,pulse_duration,pause_duration,delay,increments,currents,...
        pf_all,std_noise,mean_spikeform,frequencyforms,ISIs_all,ISIs,ISIratio,firstISI,lastISI...
        std_noise_all,mean_freq0_spikeforms_increment,mean_freq1_spikeforms_increment,...
        mean_freq2_spikeforms_increment,mean_freq3_spikeforms_increment,mean_freq4_spikeforms_increment,...
        mean_freq5_spikeforms_increment,mean_freq6_spikeforms_increment,mean_freq7_spikeforms_increment,...
        mean_freq8_spikeforms_increment,mean_freq9_spikeforms_increment,mean_freq10_spikeforms_increment,...
        mean_freq0_Isynforms_increment,mean_freq1_Isynforms_increment,...
        mean_freq2_Isynforms_increment,mean_freq3_Isynforms_increment,mean_freq4_Isynforms_increment,...
        mean_freq5_Isynforms_increment,mean_freq6_Isynforms_increment,mean_freq7_Isynforms_increment,...
        mean_freq8_Isynforms_increment,mean_freq9_Isynforms_increment,mean_freq10_Isynforms_increment,...
        mean_lastspikeforms_increment,mean_lastistepforms_increment,mean_lastIsynforms_increment,mean_lastoutputforms_increment]=...
        fi_rate(module,recdate,cellnum,trials,points,sample_rate,shouldplotFI);
    
    if saveit~=0
        save([pwd '\..\..\FI_OU\data\fi_analysis\' module '_' recdate '_' cellnum num2str(trials) '_fi'],'rate_all','peakrate','nofailrate','mean_holdingvoltage',...
            'thresholds','imp','pulse_duration',...
            'pause_duration','delay','increments','currents','pf_all','std_noise','mean_spikeform','frequencyforms',...
            'ISIs_all','ISIs','ISIratio','firstISI','lastISI',...
            'std_noise_all','mean_freq0_spikeforms_increment','mean_freq1_spikeforms_increment',...
            'mean_freq2_spikeforms_increment','mean_freq3_spikeforms_increment','mean_freq4_spikeforms_increment',...
            'mean_freq5_spikeforms_increment','mean_freq6_spikeforms_increment','mean_freq7_spikeforms_increment',...
            'mean_freq8_spikeforms_increment','mean_freq9_spikeforms_increment','mean_freq10_spikeforms_increment',...
            'mean_freq0_Isynforms_increment','mean_freq1_Isynforms_increment',...
            'mean_freq2_Isynforms_increment','mean_freq3_Isynforms_increment','mean_freq4_Isynforms_increment',...
            'mean_freq5_Isynforms_increment','mean_freq6_Isynforms_increment','mean_freq7_Isynforms_increment',...
            'mean_freq8_Isynforms_increment','mean_freq9_Isynforms_increment','mean_freq10_Isynforms_increment',...
            'mean_lastspikeforms_increment','mean_lastistepforms_increment','mean_lastIsynforms_increment','mean_lastoutputforms_increment')
    end
end

for k=1:numel(dates_all)
    recdate=dates_all{k};
    cellnum=cellnum_all{k};
    module='FI_OU';
    % trials=1:numel(whos)-3;
    trials=trials_all(k,:);
    points=points_all(k,:);
    sample_rate=10000;   % Sample rate in Hz
    shouldplotFI=0; % Should the function plot the F-I curves? 1 for yes, 0 for no.
    saveit=1;
    
    [ISI,rate_all,peakrate,nofailrate,mean_holdingvoltage,mean_r_m,std_r_m,mean_time_constant,std_time_constant,mean_c_m,std_c_m,...
        numberspikes,imp,pulse_duration,pause_duration,delay,increments,currents,pf_all,std_noise]=...
        fi_ISI_histogram(module,recdate,cellnum,trials,points,sample_rate,shouldplotFI);
    
    if saveit~=0
        save([pwd '\..\..\FI_OU\data\ISI_analysis\' module '_' recdate '_' cellnum num2str(trials) '_ISI'],'ISI','rate_all')%,'peakrate','nofailrate','mean_holdingvoltage','mean_r_m','std_r_m',...
            %'mean_time_constant','std_time_constant','mean_c_m','std_c_m','imp','pulse_duration',...
            %'pause_duration','delay','increments','currents','pf_all')
    end
end

for k=1:numel(dates_all)
    recdate=dates_all{k};
    cellnum=cellnum_all{k};
    module='FI_OU';
    % trials=1:numel(whos)-3;
    trials=trials_all(k,:);
    points=points_all(k,:);
    sample_rate=10000;   % Sample rate in Hz
    shouldplotFV=0; % Should the function plot the F-I curves? 1 for yes, 0 for no.
    saveit=1;
    
    clear('rate_all','numberspikes','imp','pulse_duration','pause_duration','delay','increments','currents','pf_all');
    
    [rate_all,numberspikes,imp,pulse_duration,pause_duration,delay,increments,currents,...
        pf_all,threshold,avg_voltage,avg_voltage_trunc,skew_noise]=...
        fV_rate(module,recdate,cellnum,trials,points,sample_rate,shouldplotFV);
    
    if saveit~=0
        save([pwd '\..\..\FI_OU\data\fV_analysis\' module '_' recdate '_' cellnum num2str(trials) '_fV'],'rate_all','imp','pulse_duration',...
        'pause_duration','delay','increments','currents','pf_all','threshold','avg_voltage','avg_voltage_trunc','skew_noise')
    end
end

% close all

toc